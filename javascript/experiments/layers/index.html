<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Layers</title>
    <style>
      * {
        transition: transform 0.15s ease-in-out;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      main {
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script>
      'use strict';

      (() => {
        const { createElement: e, useState, useEffect } = React;

        const invariant = Object.freeze({
          withinBounds: Object.freeze((value, begin, end) => {
            if (value < begin || value > end) {
              throw new Error(
                'value out of bounds, valid bounds are from ' +
                  begin +
                  ' to ' +
                  end
              );
            }
          }),
          validNumbers: Object.freeze((...numbers) => {
            if (!numbers.every(Number.isFinite)) {
              throw new Error('received value that is not a finite number');
            }
          }),
        });

        const calculateTopLayerOffset = ({
          topLayerIndex,
          offset,
          initialOffset,
        }) => {
          invariant.validNumbers(topLayerIndex, offset, initialOffset);

          return topLayerIndex * offset + initialOffset;
        };

        const calculateSizeToMoveInDirection = ({
          direction,
          topLayerSize,
          size,
          order,
          offset,
          initialOffset,
        }) => {
          invariant.validNumbers(
            direction,
            topLayerSize,
            size,
            order,
            offset,
            initialOffset
          );

          const sizeToBothEdges = topLayerSize - size;
          const sizeToOneEdge = sizeToBothEdges / 2;
          const moveToShowByOrder = order * offset;
          const moveToShow = sizeToOneEdge + moveToShowByOrder + initialOffset;

          return direction * moveToShow;
        };

        function generateLayers({ topLayerIndex, initialOffset }) {
          invariant.withinBounds(topLayerIndex, 0, 6);
          invariant.validNumbers(initialOffset);

          const size = [100, 80, 70, 60, 50, 40, 30];
          const scale = [1, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3];
          const order = [0, 1, 2, 3, 4, 5, 6];
          const right = [0, 1, 1, 1, 1, 1, 1];
          const left = [0, -1, -1, -1, -1, -1, -1];
          const zIndex = [7, 6, 5, 4, 3, 2, 1];
          const pictures = [
            {
              src: 'https://i.pinimg.com/564x/2f/19/aa/2f19aad54ba05a5ebd5e7852e10852c3.jpg',
              alt: 'denji from chainsaw man',
            },
            {
              src: 'https://i.pinimg.com/564x/19/f1/63/19f1633e1c8f8e9ac16b45ea1a187ae4.jpg',
              alt: 'power from chainsaw man',
            },
            {
              src: 'https://i.pinimg.com/564x/43/61/75/436175e69b591504d34d94e93f84c136.jpg',
              alt: 'power from chainsaw man',
            },
            {
              src: 'https://i.pinimg.com/564x/64/6e/17/646e179ffb9aaaff4c674626ee204c0a.jpg',
              alt: 'makima from chainsaw man',
            },
            {
              src: 'https://i.pinimg.com/564x/75/e4/d2/75e4d2c8868322d92e6254fe52929c34.jpg',
              alt: 'denji transformed to chainsaw from chainsaw man',
            },
            {
              src: 'https://i.pinimg.com/564x/b6/a9/39/b6a939a9456ec3eb1dd95363d55a97f8.jpg',
              alt: 'makima in the suit from chainsaw man',
            },
            {
              src: 'https://i.pinimg.com/564x/65/14/b7/6514b77834324824340015a550a9e2c0.jpg',
              alt: 'makima with crossed fingers in the suit from chainsaw man',
            },
          ];

          const assign = ({ orderBy, direction }) => ({
            size: size[orderBy],
            scale: scale[orderBy],
            order: order[orderBy],
            direction: direction[orderBy],
            zIndex: zIndex[orderBy],
          });

          const layers = new Array(7);

          let i = topLayerIndex;
          let orderBy = 0;
          while (i >= 0) {
            layers[i] = assign({ orderBy, direction: left });
            ++orderBy;
            --i;
          }

          i = topLayerIndex;
          orderBy = 0;
          while (i <= 6) {
            layers[i] = assign({ orderBy, direction: right });
            ++orderBy;
            ++i;
          }

          i = 0;
          while (i != 7) {
            layers[i].index = i;
            layers[i].picture = pictures[i];
            layers[i].topLayerIndex = topLayerIndex;
            layers[i].topLayerSize = 100;
            layers[i].offset = 10;
            layers[i].initialOffset = initialOffset;
            ++i;
          }

          return layers;
        }

        function PictureLayers(props) {
          const [layers, setLayers] = useState(
            generateLayers({
              topLayerIndex: props.topLayerIndex,
              initialOffset: props.initialOffset,
            })
          );

          return e(
            'article',
            {
              style: {
                display: 'flex',
                alignItems: 'center',
                flexDirection: 'column',
              },
            },
            e(
              'div',
              {
                style: {
                  width: props.containerWidth,
                  height: 1.5 * props.width,
                  position: 'relative',
                },
              },
              layers.map((layer) => {
                return e(
                  'div',
                  {
                    style: {
                      zIndex: layer.zIndex,
                      width: props.width,
                      height: 0,
                      position: 'absolute',
                      transform: `translateX(${calculateTopLayerOffset({
                        topLayerIndex: layer.topLayerIndex,
                        offset: layer.offset,
                        initialOffset: layer.initialOffset,
                      })}%)`,
                    },
                    key: layer.index,
                  },
                  e(
                    'div',
                    {
                      style: {
                        position: 'absolute',
                        width: props.width,
                        height: 0,
                        transform: `translateX(${calculateSizeToMoveInDirection(
                          {
                            direction: layer.direction,
                            topLayerSize: layer.topLayerSize,
                            size: layer.size,
                            order: layer.order,
                            offset: layer.offset,
                            initialOffset: layer.initialOffset,
                          }
                        )}%)`,
                      },
                    },
                    e(
                      'button',
                      {
                        style: {
                          width: props.width,
                          height: props.width * 1.5,
                          transform: `scale(${layer.scale})`,
                          padding: 0,
                          border: 0,
                          cursor: 'pointer',
                        },
                        onClick: () =>
                          setLayers(
                            generateLayers({
                              topLayerIndex: layer.index,
                              initialOffset: layer.initialOffset,
                            })
                          ),
                      },
                      e('img', {
                        style: { width: '100%', height: '100%' },
                        src: layer.picture.src,
                        alt: layer.picture.alt,
                      })
                    )
                  )
                );
              })
            ),
            e(
              'div',
              {
                style: {
                  width: props.containerWidth,
                  paddingTop: '20px',
                  display: 'flex',
                },
              },
              e(
                'button',
                { style: { flex: '1', cursor: 'pointer', padding: '5px' } },
                '< left'
              ),
              e(
                'button',
                {
                  style: {
                    flex: '1',
                    cursor: 'pointer',
                    padding: '5px',
                    marginLeft: '20px',
                  },
                },
                'right >'
              )
            )
          );
        }

        function CreatePictureLayers() {
          const [width, setWidth] = useState(window.innerWidth / 4);

          useEffect(() => {
            window.addEventListener('resize', () => {
              setWidth(window.innerWidth / 4);
            });
          }, [setWidth]);

          return e(
            'main',
            null,
            e(PictureLayers, {
              width,
              containerWidth: 1.6 * width,
              topLayerIndex: 3,
              initialOffset: 0,
            }),
            e('div', { style: { padding: '10px' } }),
            e(PictureLayers, {
              width,
              containerWidth: 3.2 * width,
              topLayerIndex: 3,
              initialOffset: 80,
            })
          );
        }

        ReactDOM.createRoot(document.querySelector('#root')).render(
          e(React.StrictMode, null, e(CreatePictureLayers))
        );
      })();
    </script>
  </body>
</html>
