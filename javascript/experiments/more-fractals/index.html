<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>More Fractals</title>

    <style>
      :root {
        --black: #000000;
      }

      canvas {
        border: 1px solid var(--black);
      }
    </style>
  </head>
  <body>
    <!-- I like to use width and height 360 because many devices support it so
      I don't need to take care of responsiveness -->
    <canvas id="more-fractals" width="360" height="360"></canvas>
    <script>
      const moreFractals = 'more-fractals';
      const canvas = document.getElementById(moreFractals);
      const ctx = canvas.getContext('2d');

      /**
       * @param {number} degree
       */
      function radians(degree) {
        return degree * (Math.PI / 180);
      }

      /**
       * @typedef {Object} Point
       * @property {number} Point.x
       * @property {number} Point.y
       */

      /**
       * @param {Object} options
       * @param {Point} options.from
       * @param {number} options.angle
       * @param {number} options.length
       */
      function point({ from, angle, length }) {
        const angleInRadians = radians(angle);

        return {
          x: from.x + length * Math.cos(angleInRadians),
          y: from.y + length * Math.sin(angleInRadians),
        };
      }

      /**
       * @typedef {(point: Point) => void} UsePoint
       */

      /**
       * @typedef {() => void} Handler
       */

      /**
       * @typedef {Object} CanopyOptions
       * @property {Point} CanopyOptions.from
       * @property {number} CanopyOptions.angle
       * @property {number} CanopyOptions.length
       * @property {number} CanopyOptions.level
       */

      /**
       * @param {Object} options
       * @param {UsePoint} options.useInitialPoint
       * @param {UsePoint} options.useSubsequentPoint
       * @param {Handler} options.onBeforeGenerate
       * @param {Handler} options.onAfterGenerate
       */
      function createFractalCanopyPointsGenerator(options = {}) {
        const changeLeftAngle = 30;
        const scaleLeftLength = 0.8;

        const changeRightAngle = 30;
        const scaleRightLength = 0.8;

        const changeLevel = 1;

        /**
         * @param {CanopyOptions} canopyOptions
         */
        function generateFractalCanopyPoints({ from, angle, length, level }) {
          if (level > 0) {
            generateFractalCanopyPoints({
              from: point({
                from,
                angle,
                length,
              }),
              angle: angle - changeLeftAngle,
              length: length * scaleLeftLength,
              level: level - changeLevel,
            });
            generateFractalCanopyPoints({
              from: point({
                from,
                angle,
                length,
              }),
              angle: angle + changeRightAngle,
              length: length * scaleRightLength,
              level: level - changeLevel,
            });
            options.useSubsequentPoint(from);
          } else {
            options.useInitialPoint(from);
          }
        }

        /**
         * @param {CanopyOptions} canopyOptions
         */
        return function fractalCanopyPointsGenerator(canopyOptions) {
          options.onBeforeGenerate();
          generateFractalCanopyPoints(canopyOptions);
          options.onAfterGenerate();
        };
      }

      const generateFractalCanopyPoints = createFractalCanopyPointsGenerator({
        useInitialPoint: (point) => {
          ctx.moveTo(point.x, point.y);
        },
        useSubsequentPoint(point) {
          ctx.lineTo(point.x, point.y);
        },
        onBeforeGenerate() {
          ctx.beginPath();
        },
        onAfterGenerate() {
          ctx.stroke();
          ctx.closePath();
        },
      });

      /**
       * @return {CanopyOptions}
       */
      function createSettings() {
        const bottomOffset = 50;
        const midBottom = {
          x: canvas.clientWidth / 2,
          y: canvas.clientHeight - bottomOffset,
        };
        const initialAngle = -90;
        const initialLength = 50;
        const level = 10;

        /** @type {CanopyOptions} */
        const settings = {
          from: midBottom,
          angle: initialAngle,
          length: initialLength,
          level,
        };

        return settings;
      }

      generateFractalCanopyPoints(createSettings());
    </script>
  </body>
</html>
